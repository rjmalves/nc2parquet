nc_key: s3://climate-models/cmip6/temperature_monthly_2020-2023.nc
variable_name: tas
parquet_key: s3://climate-analysis/processed/temperature_trends.parquet

filters:
  - kind: range
    params:
      dimension_name: lat
      min_value: -60.0  
      max_value: 80.0
  - kind: range
    params:
      dimension_name: lon
      min_value: -180.0
      max_value: 180.0

postprocessing:
  name: Climate Model Processing Pipeline
  processors:
    - type: RenameColumns
      mappings:
        tas: temperature_surface
        lat: latitude_deg
        lon: longitude_deg
        time: months_since_2020
        
    - type: DatetimeConvert
      column: months_since_2020
      base: "2020-01-01T00:00:00Z"
      unit: months
      
    - type: UnitConvert
      column: temperature_surface
      from_unit: kelvin
      to_unit: celsius
      
    - type: ApplyFormula
      target_column: temperature_anomaly
      formula: temperature_surface - 14.0  # Global mean baseline
      source_columns: [temperature_surface]
      
    - type: ApplyFormula
      target_column: warming_indicator
      formula: temperature_anomaly > 1.5
      source_columns: [temperature_anomaly]
      
    - type: ApplyFormula
      target_column: latitude_zone
      formula: "latitude_deg / 30.0"  # Rough climate zone indicator
      source_columns: [latitude_deg]
      
    - type: Aggregate
      group_by: [latitude_zone]
      aggregations:
        temperature_surface: mean
        temperature_anomaly: mean
        warming_indicator: sum